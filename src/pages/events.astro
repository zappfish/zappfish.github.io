---
import { getCollection, render } from "astro:content";
import MainLayout from "../layouts/Main.astro";

const events = await getCollection("events")

// Function to create a URL-friendly ID from the event title
function createEventId(title: string): string {
    return title.toLowerCase()
        .replace(/[^\w\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-')
        .trim();
}

---

<MainLayout frontmatter={{ title: "Events" }}>
    <nav class="events-navigation">
        <h2>Quick Navigation</h2>
        <ul>
            {events.map(entry => {
                const eventId = createEventId(entry.data.title);
                return (
                    <li>
                        <a href={`#${eventId}`}>{entry.data.title}</a>
                    </li>
                );
            })}
        </ul>
    </nav>

    {events.map(async entry => {
        const { Content } = await render(entry)
        const eventId = createEventId(entry.data.title);

        return (
        <section id={eventId} class="event-section">
            <h2>{entry.data.title}</h2>
            <p><strong>Day: </strong>{entry.data.date}</p>
            <p><strong>Time: </strong>{entry.data.time}</p>
            <p><strong>Location: </strong>{entry.data.location}</p>
            <p><strong>Topic: </strong>{entry.data.topic}</p>
            <p><strong>Sign up for this event <a href={entry.data.signup}>here</a></strong></p>
            <Content />
        </section>
        )
    })}
</MainLayout>

<style>
    .events-navigation {
        background-color: #f5f5f5;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border-radius: 8px;
        border: 1px solid #ddd;
    }

    .events-navigation h2 {
        margin-top: 0;
        font-size: 1.25rem;
        color: #333;
    }

    .events-navigation ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .events-navigation li {
        margin: 0.5rem 0;
    }

    .events-navigation a {
        color: #0066cc;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s;
    }

    .events-navigation a:hover {
        color: #004499;
        text-decoration: underline;
    }

    .event-section {
        scroll-margin-top: 2rem;
        padding-top: 1rem;
    }

    .event-section:not(:last-child) {
        border-bottom: 2px solid #eee;
        padding-bottom: 2rem;
        margin-bottom: 2rem;
    }
</style>
